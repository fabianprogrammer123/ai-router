# ============================================================
# AI Router — Environment Variables
# ============================================================
# Copy this file to .env and fill in your values.
# NEVER commit .env to git.

# ── Required ─────────────────────────────────────────────────
# The API key your applications use to authenticate with the router
ROUTER_API_KEY=your-secret-router-key-here

# Provider API keys (at least one required; others enable fallback)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
GOOGLE_API_KEY=AIza...

# ── Server ───────────────────────────────────────────────────
PORT=3000
HOST=0.0.0.0
LOG_LEVEL=info

# ── Routing ──────────────────────────────────────────────────
# Comma-separated provider priority order
PROVIDER_PRIORITY=openai,anthropic,google

# Strategy: "fallback" (try next on failure) | "round-robin" | "latency"
DEFAULT_ROUTING_STRATEGY=fallback

# ── Request Queue ─────────────────────────────────────────────
# Max requests to hold in queue when all providers are rate-limited
QUEUE_MAX_SIZE=100

# Total time before a queued request times out (ms)
QUEUE_TIMEOUT_MS=30000

# Wait time threshold for switching from inline 200 to async 202 response (ms)
QUEUE_ASYNC_THRESHOLD_MS=5000

# ── Circuit Breaker ───────────────────────────────────────────
# Number of consecutive 5xx failures to open circuit
CB_FAILURE_THRESHOLD=5

# How long circuit stays open before attempting half-open test (ms)
CB_COOLDOWN_MS=60000

# ── Rate Limit Proactive Avoidance ───────────────────────────
# Skip a provider when remaining requests OR tokens falls below this count
RATE_LIMIT_LOW_REQUESTS_THRESHOLD=5

# ── Redis (optional) ──────────────────────────────────────────
# When set, enables persistent state + multi-instance coordination.
# If unset, the router runs fully in-memory (restarts reset rate limit state).
#
# Supported formats:
#   redis://[:password@]host[:port][/db]    (plain TCP)
#   rediss://[:password@]host[:port][/db]   (TLS — for Railway, Render, Fly.io managed Redis)
#   /tmp/redis.sock                         (Unix socket path)
#
# Examples:
#   REDIS_URL=redis://localhost:6379
#   REDIS_URL=rediss://default:password@your-redis.example.com:6380
#
# REDIS_URL=redis://localhost:6379
